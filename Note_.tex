\documentclass{article}
\usepackage{hyperref}
\title{Steps to Deploy FastAPI App on EC2}
\author{}
\date{}
\begin{document}

\maketitle

\section{Create an AWS Account}
\begin{itemize}
    \item Go to the \href{https://aws.amazon.com/}{AWS website} and sign up for an account.
    \item Enter your contact information, billing details, and payment method. AWS offers a free tier that allows limited usage of many of its services at no cost.
    \item Verify your identity with a phone number.
\end{itemize}

\section{Launch an EC2 Instance}
\begin{itemize}
    \item \textbf{Log in to AWS Management Console:} Go to the \href{https://aws.amazon.com/console/}{AWS Management Console} and choose \textbf{EC2} from the Services menu.
    \item \textbf{Launch Instance:} In the EC2 Dashboard, click \textbf{Launch Instance} to create a new EC2 instance.
    \item Choose an Amazon Machine Image (AMI), such as \textbf{Ubuntu Server 20.04 LTS} or another suitable Linux distribution.
    \item Select an instance type, for example, \texttt{t2.micro} (which is eligible for the AWS Free Tier).
    \item \textbf{Configure Instance:} Set up the instance details (default options are generally fine). Add storage if needed (the default is usually fine).
    \item \textbf{Configure Security Group:} Set up a security group to allow traffic on SSH (port 22) and HTTP (port 8080). You can add more ports later as needed.
    \item \textbf{Review and Launch:} Review your instance configuration and click \textbf{Launch}.
    \item Create or select an existing key pair for SSH access. If you create a new one, download the \texttt{.pem} file, as youâ€™ll need it to access the EC2 instance later.
\end{itemize}

\section{SSH into the EC2 Instance}
\begin{itemize}
    \item \textbf{Access EC2 Instance:} Use SSH to connect to your EC2 instance:
    \begin{verbatim}
    chmod 400 path_to_your_key.pem
    ssh -i path_to_your_key.pem ubuntu@<your-ec2-public-ip>
    (for windows, we copy ssh to home directory using mv /mnt/c/Users/USER/Documents/1030/Portfolio_Projects/mi_fatality_prediction/fastapi-key-pair.pem ~/fastapi-key-pair.pem and then we SSH into EC2 using
    chmod 400 ~/fastapi-key-pair.pem
and ssh -i ~/fastapi-key-pair.pem ubuntu@3.143.204.49
    \end{verbatim}
\end{itemize}

\section{Set Up the EC2 Instance}
\begin{itemize}
    \item \textbf{Update the Instance:} Run the following commands to update your EC2 instance:
    \begin{verbatim}
    sudo apt update && sudo apt upgrade -y
    \end{verbatim}
    \item \textbf{Install Necessary Dependencies:} Install Docker, Docker Compose, and Python packages:
    \begin{verbatim}
    sudo apt install python3 python3-pip python3-venv docker.io docker-compose -y
    \end{verbatim}
\end{itemize}

\section{Transfer Your Application Files to EC2}
\begin{itemize}
	\item clone your complete project from github and cd into the project OR
    \item \textbf{Create a Directory for Your App:} On the EC2 instance, create a directory for your FastAPI project:
    \begin{verbatim}
    mkdir ~/mi_fatality_prediction
    cd ~/mi_fatality_prediction
    \end{verbatim}
    \item \textbf{Transfer Files:} Use \texttt{scp} (secure copy) to transfer your application files (such as \texttt{main.py}, \texttt{Dockerfile}, \texttt{docker-compose.yml}, and model files) from your local machine to the EC2 instance:
    \begin{verbatim}
    scp -i path_to_your_key.pem main.py Dockerfile docker-compose.yml <your-ec2-public-ip>:~/mi_fatality_prediction/
    \end{verbatim}
\end{itemize}

\section{Create Docker Environment}
\begin{itemize}
    \item \textbf{Dockerfile:} Create a \texttt{Dockerfile} in your project directory to containerize your FastAPI application. Example \texttt{Dockerfile}:
    \begin{verbatim}
    FROM python:3.9-slim

    WORKDIR /app

    COPY . /app

    RUN pip install --no-cache-dir -r requirements.txt

    CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8080"]
    \end{verbatim}
    \item \textbf{docker-compose.yml:} Create a \texttt{docker-compose.yml} file to manage the app container. Example \texttt{docker-compose.yml}:
    \begin{verbatim}
    version: '3.8'
    services:
      fastapi_app:
        build: .
        ports:
          - "8080:8080"
    \end{verbatim}
\end{itemize}

\section{Prepare Python Requirements}
\begin{itemize}
    \item \textbf{Create a \texttt{requirements.txt}:} Inside the project directory, create a \texttt{requirements.txt} file that includes all necessary Python packages:
    \begin{verbatim}
    fastapi
    uvicorn
    joblib
    \end{verbatim}
\end{itemize}

\section{Build and Run the Docker Container}
\begin{itemize}
    \item \textbf{Build the Docker Container:} On the EC2 instance, build the Docker image and run the app using Docker Compose:
    \begin{verbatim}
    sudo docker-compose up --build -d
    \end{verbatim}
\end{itemize}

\section{Check Application Logs}
\begin{itemize}
    \item \textbf{Check Logs:} To verify that everything is running correctly, check the logs of the FastAPI container:
    \begin{verbatim}
    sudo docker-compose logs -f
    \end{verbatim}
\end{itemize}

\section{Open Ports on EC2 Security Group}
\begin{itemize}
    \item \textbf{Configure Security Group:} Go to the \textbf{EC2 Dashboard} in the AWS console and navigate to \textbf{Security Groups}.
    \item Select the security group attached to your EC2 instance.
    \item Add an inbound rule for \textbf{HTTP} on port \texttt{8080} to allow external access to the application.
\end{itemize}

\section{Test the FastAPI Application}
\begin{itemize}
    \item \textbf{Test with curl:} On the EC2 instance or from your local machine, test the FastAPI endpoint using \texttt{curl}:
    \begin{verbatim}
    curl -X POST http://<your-ec2-public-ip>:8080/predict \
      -H "Content-Type: application/json" \
      -d '[{ "AGE": 0, "SEX": 0, "INF_ANAM": 0, ... }]'
    \end{verbatim}
    \item \textbf{Verify the Output:} Ensure that the application returns a prediction or response as expected.
\end{itemize}

\section{Access Application from Browser}
\begin{itemize}
    \item \textbf{Access the Application:} You should now be able to access the application by going to \texttt{http://<your-ec2-public-ip>:8080/predict} from any web browser or API testing tool like \textbf{Postman}.
\end{itemize}

\section{Finalize and Document}
\begin{itemize}
    \item \textbf{Document the Deployment:} Document the steps you've followed to deploy your FastAPI application, including:
    \begin{itemize}
        \item How to configure EC2 and set up security groups.
        \item How to build and deploy your Dockerized FastAPI application.
        \item How to test the application using \texttt{curl} or \textbf{Postman}.
    \end{itemize}
\end{itemize}

\end{document}
